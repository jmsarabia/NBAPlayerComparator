<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>NBA Player Comparator</title>
    <style type="text/css">
    </style>
  </head>
<body>
  
<h1>NBA Player Comparator</h1>

<script src="https://d3js.org/d3.v4.min.js"></script>
      
<script type="text/javascript">

var allplayers = [];

function alreadyExists(name) {
  for(t = 0 ; t < allplayers.length ; t++) {
    if(allplayers[t].name == name) {
      return t;
    }
  }
  return -1;
}

function getBestPlayers() {
  var bestplayers = [];
  for(r = 0 ; r < allplayers.length ; r++) {
    seasons_arr = allplayers[r].seasons;
    var total_points = 0;
    for(e = 0 ; e < seasons_arr.length ; e++) {
      total_points += seasons_arr[e].points;
    }
    if(total_points > 15000) {
      bestplayers.push(allplayers[r]);
    }
  }
  return bestplayers;
}

function debugging(bestplayers) {
  for(q = 0 ; q < bestplayers.length ; q++) {
    console.log(bestplayers[q].name);
  }
  console.log("LENGTH: " + bestplayers.length);
} 

//setting up the margins
var margin = {top: 50, right: 50, bottom: 50, left: 50},
width = 960 - margin.left - margin.right,
height = 700 - margin.top - margin.bottom;

//adding svg to page
var svg = d3.select("body").append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

//reading in player data
d3.csv("seasonstats.csv", function(data) {
  data.forEach(function(d) {
    var name = d.Player;
    var index = alreadyExists(name);

    if(index == -1) {

      var season = {year: +d.Year, points: +d.PTS, assists: +d.AST,
        rebounds: +d.TRB, steals: +d.STL, blocks: +d.BLK,
        plusminus: +d.BPM, games: +d.G, position: d.Pos, team: d.Tm,
        age: +d.Age, minutes: +d.MP, threepointers: +d.THREEP,
        fieldgoalpercent: +d.FGPERC, threepointerpercent: +d.THREEPPERC};

      var player = {name: d.Player, seasons: []};
      player.seasons.push(season);
      
      allplayers.push(player);

    } else {

      var season = {year: +d.Year, points: +d.PTS, assists: +d.AST,
        rebounds: +d.TRB, steals: +d.STL, blocks: +d.BLK,
        plusminus: +d.BPM, games: +d.G, position: d.Pos, team: d.Tm,
        age: +d.Age, minutes: +d.MP, threepointers: +d.THREEP,
        fieldgoalpercent: +d.FGPERC, threepointerpercent: +d.THREEPPERC};

      allplayers[index].seasons.push(season);

    }

  });

  bestplayers = getBestPlayers();

  bestplayers.sort(function(a,b) {
    var x = a.name.toLowerCase();
    var y = b.name.toLowerCase();
    return x < y ? -1 : x > y ? 1 : 0;
  });

  debugging(bestplayers);
  
  svg.append("text")             
    .attr("transform",
          "translate(" + (width/2) + " , -10)")
    .style("text-anchor", "middle")
    .style("font-weight", "bold")
    .style("font-size", "24px")
    .text("Testing Design Element: Player filter");

  var select1 = d3.select('body')
    .append('select')
    .attr('class','select')
    .style('position', 'absolute')
    .style('top', '200px')
    .style('left', '20px')
    .on('change',onchange1)

  var options1 = select1
    .selectAll('option')
    .data(bestplayers).enter()
    .append('option')
    .text(function (d) { return d.name; });

  var select2 = d3.select('body')
    .append('select')
    .attr('class','select2')
    .style('position', 'absolute')
    .style('top', '170px')
    .style('left', '20px')
    .on('change',onchange2)

  var options2 = select2
    .selectAll('option')
    .data(bestplayers).enter()
    .append('option')
    .text(function (d) { return d.name; });

  svg.append("rect")
    .attr("x", -50)
    .attr("y", 0)
    .attr("width", 175)
    .attr("height", 100)
    .style("fill", "CornflowerBlue ")
    .style("opacity", 0.8);

  svg.append("rect")
    .attr("x", -50)
    .attr("y", 0)
    .attr("width", 175)
    .attr("height", 30)
    .style("fill", "DarkRed")
    .style("opacity", 0.8);

  svg.append("text")             
    .attr("transform",
          "translate(35, 20)")
    .style("text-anchor", "middle")
    .style("font-weight", "bold")
    .style("font-size", "17px")
    .text("Player Filter")
    .attr("fill", "white");


  svg.append("text")             
    .attr("transform",
          "translate(" + (width/2) + " , 200)")
    .style("text-anchor", "middle")
    .style("font-weight", "bold")
    .style("font-size", "24px")
    .text("Testing Data: Printing all NBA players with 15,000 points or more");

    svg.selectAll("text")
      .data(bestplayers)
      .enter()
      .append("text")
      .text(function(d) {
        return d.name;
      })
      .attr("text-anchor", "middle")
      .attr("x", function(d, i) {
        return 100 * (i % 9);
      })
      .attr("y", function(d, i) {
        return 20 * (Math.floor(i/9));
      })
      .attr("font-family", "sans-serif")
      .attr("transform",
          "translate(" + 0 + " , 230)")
      .attr("font-size", "11px")
      .attr("fill", "black");

    function onchange1() {
      selectValue = d3.select('select').property('value')
      d3.select('body')
        .append('p')
        .text(selectValue + ' is the last selected option.')
    };

    function onchange2() {
      selectValue = d3.select('select').property('value')
      d3.select('body')
        .append('p')
        .text(selectValue + ' is the last selected option.')
    };

});


</script>

  </body>
</html>
