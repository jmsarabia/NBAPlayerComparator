<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>NBA Player Comparator</title>
    <style type="text/css">
    </style>
  </head>
<body>
  
<h1>NBA Player Comparator</h1>

<script src="https://d3js.org/d3.v4.min.js"></script>
      
<script type="text/javascript">

var allplayers = [];

function alreadyExists(name) {
  for(t = 0 ; t < allplayers.length ; t++) {
    if(allplayers[t].name == name) {
      return t;
    }
  }
  return -1;
}

function getBestPlayers() {
  var bestplayers = [];
  for(r = 0 ; r < allplayers.length ; r++) {
    seasons_arr = allplayers[r].seasons;
    var total_points = 0;
    for(e = 0 ; e < seasons_arr.length ; e++) {
      total_points += seasons_arr[e].points;
    }
    if(total_points > 20000) {
      bestplayers.push(allplayers[r]);
    }
  }
  return bestplayers;
}

function formatName(name) {
  var string = name.replace(" ", "");
  string = string.replace("*", "");
  string += ".png";
  return string;
}

function debugging(bestplayers) {
  for(q = 0 ; q < bestplayers.length ; q++) {
    console.log(bestplayers[q].name);
  }
  console.log("LENGTH: " + bestplayers.length);
} 

//setting up the margins
var margin = {top: 50, right: 50, bottom: 50, left: 50},
width = 960 - margin.left - margin.right,
height = 700 - margin.top - margin.bottom;

//adding svg to page
var svg = d3.select("body").append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

//reading in player data
d3.csv("seasonstats.csv", function(data) {
  data.forEach(function(d) {
    var name = d.Player;
    var index = alreadyExists(name);

    if(index == -1) {

      var season = {year: +d.Year, points: +d.PTS, assists: +d.AST,
        rebounds: +d.TRB, steals: +d.STL, blocks: +d.BLK,
        plusminus: +d.BPM, games: +d.G, position: d.Pos, team: d.Tm,
        age: +d.Age, minutes: +d.MP, threepointers: +d.THREEP,
        fieldgoalpercent: +d.FGPERC, threepointerpercent: +d.THREEPPERC};

      var player = {name: d.Player, seasons: []};
      player.seasons.push(season);
      
      allplayers.push(player);

    } else {

      var season = {year: +d.Year, points: +d.PTS, assists: +d.AST,
        rebounds: +d.TRB, steals: +d.STL, blocks: +d.BLK,
        plusminus: +d.BPM, games: +d.G, position: d.Pos, team: d.Tm,
        age: +d.Age, minutes: +d.MP, threepointers: +d.THREEP,
        fieldgoalpercent: +d.FGPERC, threepointerpercent: +d.THREEPPERC};

      allplayers[index].seasons.push(season);

    }

  });

  bestplayers = getBestPlayers();

  bestplayers.sort(function(a,b) {
    var x = a.name.toLowerCase();
    var y = b.name.toLowerCase();
    return x < y ? -1 : x > y ? 1 : 0;
  });

  // debugging(bestplayers);

  var select1 = d3.select('body')
    .append('select')
    .attr('class','select')
    .attr('id', 'one')
    .style('position', 'absolute')
    .style('top', '150px')
    .style('left', '20px')
    .on('change',onchange1)

  var options1 = select1
    .selectAll('option')
    .data(bestplayers).enter()
    .append('option')
    .text(function (d) { return d.name; });

  var select2 = d3.select('body')
    .append('select')
    .attr('class','select')
    .attr('id', 'two')
    .style('position', 'absolute')
    .style('top', '180px')
    .style('left', '20px')
    .on('change',onchange2)

  var options2 = select2
    .selectAll('option')
    .data(bestplayers).enter()
    .append('option')
    .text(function (d) { return d.name; });

  svg.append("rect")
    .attr("x", -50)
    .attr("y", -20)
    .attr("width", 175)
    .attr("height", 100)
    .style("fill", "CornflowerBlue ")
    .style("opacity", 0.8);

  svg.append("rect")
    .attr("x", -50)
    .attr("y", -20)
    .attr("width", 175)
    .attr("height", 30)
    .style("fill", "DarkRed")
    .style("opacity", 0.8);

  svg.append("text")             
    .attr("transform",
          "translate(35, 0)")
    .style("text-anchor", "middle")
    .style("font-weight", "bold")
    .style("font-size", "17px")
    .text("Player Filter")
    .attr("fill", "white");

    d3.selectAll("svg")
      .append("image")
      .attr("xlink:href", "playerpictures/" + formatName(d3.select('select#one').property('value')))
      .attr("class", "pico")
      .attr("id", "pic_one")
      .attr("height", 240)
      .attr("width", 400)
      .attr("x", 100)
      .attr("y", 30);

    svg.append("text")             
      .attr("transform",
          "translate(250, 240)")
      .attr("id", "text_one")
      .style("text-anchor", "middle")
      .style("font-weight", "bold")
      .style("font-size", "14px")
      .text(function() {
        return d3.select('select#one').property('value').replace("*", "");
      })
      .attr("fill", "black");

    d3.selectAll("svg")
      .append("image")
      .attr("xlink:href", "playerpictures/" + formatName(d3.select('select#two').property('value')))
      .attr("class", "pico")
      .attr("id", "pic_two")
      .attr("height", 240)
      .attr("width", 400)
      .attr("x", 340)
      .attr("y", 30);

    svg.append("text")             
      .attr("transform",
          "translate(480, 240)")
      .attr("id", "text_two")
      .style("text-anchor", "middle")
      .style("font-weight", "bold")
      .style("font-size", "14px")
      .text(function() {
        return d3.select('select#two').property('value').replace("*", "");
      })
      .attr("fill", "black");

    function onchange1() {
      selectValue = d3.select('select#one').property('value');
      d3.select('image#pic_one').attr("xlink:href", "playerpictures/" + formatName(selectValue));
      d3.select('text#text_one').text(selectValue.replace("*", ""));
    };

    function onchange2() {
     selectValue = d3.select('select#two').property('value')
     d3.select('image#pic_two').attr("xlink:href", "playerpictures/" + formatName(selectValue));
     d3.select('text#text_two').text(selectValue.replace("*", ""));
    };

});


</script>

  </body>
</html>
