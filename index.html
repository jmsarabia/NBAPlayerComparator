<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>NBA Player Comparator</title>
    <style type="text/css">

div.tooltip { 
    position: absolute;     
    text-align: center;     
    width: 200px;          
    height: 100px;         
    padding: 4px;       
    font: 12px sans-serif;
    border: 0px;    
    border-radius: 8px;     
    pointer-events: none;     
}

img {
    position: absolute;
    top: 0px;
    right: -50;
}

    </style>
  </head>
<body>
<img src="logo.png" alt="logo" width="430" height="70" class>

<script src="https://d3js.org/d3.v4.min.js"></script>
      
<script type="text/javascript">

var allplayers = [];
var playoffsArr = [];
var careerPL = [];

var teammap = {"BUF": "Buffalo Braves", "IND": "Indiana Pacers", 
"LAL": "Los Angeles Lakers", "UTA": "Utah Jazz", "DET": "Detroit Pistons",
"DAL": "Dallas Mavericks", "MIL": "Milwaukee Bucks", "DEN": "Denver Nuggets", "DEV": "Denver Nuggets",
"PHI": "Philadelphia 76ers", "MEM": "Memphis Grizzlies", "GSW": "Golden State Warriors", 
"WAS": "Washington Wizards", "CLE": "Cleveland Cavaliers", "LAC": "Los Angeles Clippers",
"NYK": "New York Knicks", "BOS": "Boston Celtics", "NJN": "New Jersey Nets",
"MLH": "Milwaukee Hawks", "STL": "St. Louis Hawks", "TOT": "Multiple teams",
"PHO": "Phoenix Suns", "HOU": "Houston Rockets", "POR": "Portland Trail Blazers",
"SEA": "Seattle SuperSonics", "SAS": "San Antonio Spurs", "CHH": "Charlotte Hornets",
"ATL": "Atlanta Hawks", "ORL": "Orlando Magic", "MIA": "Miami Heat", "CHI": "Chicago Bulls",
"KCK": "Kansas City Kings", "SAC": "Sacramento Kings", "MNL": "Minneapolis Lakers",
"SDR": "San Diego Rockets", "BAL": "Baltimore Bullets", "CAP": "Capital Bullets",
"WSB": "Washington Bullets", "TOR": "Toronto Raptors", "SYR": "Syracuse Nationals",
"BRK": "Brooklyn Nets", "MIN": "Minnesota Timberwolves", "CIN": "Cincinnati Royals",
"SDC": "San Diego Clippers", "CHP": "Chicago Packers", "CHZ": "Chicago Zephyrs",
"NOJ": "New Orleans Jazz", "PHW": "Philadelphia Warriors", "OKC": "Oklahoma City Thunder",
"NOK": "New Orleans Hornets", "NOH": "New Orleans Hornets", "SFW": "San Francisco Warriors"};

var moreplayers = ["Kevin Durant", "James Harden", "Stephen Curry", "Russell Westbrook", 
"Chris Paul", "Chris Webber", "Chris Bosh", "Dwight Howard", "Isiah Thomas",
"Jamal Crawford", "Jason Kidd", "Jason Terry", "Mike Bibby", "Rudy Gay",
"Scottie Pippen", "Steve Nash", "Tony Parker", "Paul George", "Bob Lanier",
"Bob McAdoo", "Clifford Robinson", "Walter Davis", "Dale Ellis", "Eddie Johnson"];

function alreadyExists(name) {
  for(t = 0 ; t < allplayers.length ; t++) {
    if(allplayers[t].name == name) {
      return t;
    }
  }
  return -1;
}

function getBestPlayers() {
  var bestplayers = [];
  for(r = 0 ; r < allplayers.length ; r++) {
    seasons_arr = allplayers[r].seasons;
    var total_points = 0;
    for(e = 0 ; e < seasons_arr.length ; e++) {
      total_points += seasons_arr[e].points;
    }
    if(total_points > 20000) {
      bestplayers.push(allplayers[r]);
    }
    if(moreplayers.includes(allplayers[r].name.replace("*", ""))) {
      bestplayers.push(allplayers[r]);
    }
  }
  return bestplayers;
}

function formatName(name) {
  var string = name.replace(" ", "");
  string += ".png";
  return string;
}

function debugging1(bestplayers) {
  for(q = 0 ; q < bestplayers.length ; q++) {
    console.log(bestplayers[q].name);
    console.log(round(bestplayers[q].averages[5], 1));
      // for(e = 0 ; e < bestplayers[q].seasons.length ; e++) {
      //   console.log(bestplayers[])
        // console.log(bestplayers[q].seasons[e].year);
        // console.log(bestplayers[q].seasons[e].playoffs);
        // if(bestplayers[q].seasons[e].team.length > 1) {
        //   for(w = 0 ; w < bestplayers[q].seasons[e].team.length ; w++) {
        //     console.log(bestplayers[q].seasons[e].team[w]);
        //   }
        // } else {
        //   console.log(bestplayers[q].seasons[e].team[0]);
        // }
    // }
  // console.log("LENGTH: " + bestplayers.length);
  }
}

function debugging2() {
  for(q = 0 ; q < playoffsArr.length ; q++) {
    console.log(playoffsArr[q].playoffYear);
    for(w = playoffsArr[q].results.length - 1 ; w >= 0 ; w--) {
      if(playoffsArr[q].results[w].series == "Finals") {
        console.log("Champion: " + playoffsArr[q].results[w].winner);
        console.log("Finalist: " + playoffsArr[q].results[w].loser);
      } else {
        console.log(playoffsArr[q].results[w].loser + " lost in " + playoffsArr[q].results[w].series);
      }
    }
  }
  console.log("LENGTH: " + bestplayers.length);
}

function yearAdded(index, year) {
  for(s = 0 ; s < allplayers[index].seasons.length ; s++) {
    if(allplayers[index].seasons[s].year == year) {
      return s;
    }
  }
  return -1;
}

function getIndex(player, bestplayers) {
  for(g = 0 ; g < bestplayers.length ; g++) {
    if(bestplayers[g].name.replace("*", "") == player) {
      return g;
    }
  }
}

function yearExists(year) {
  for(r = 0 ; r < playoffsArr.length ; r++) {
    if(playoffsArr[r].playoffYear == year) {
      return r;
    }
  }
  return -1;
}

function setPlayoffs(bestplayers) {
  for(p = 0 ; p < bestplayers.length ; p++) {
    for(y = 0 ; y < bestplayers[p].seasons.length ; y++) {
      var numberteams = bestplayers[p].seasons[y].team.length;
      if(numberteams == 1) {
        var teamName = getTeamName(bestplayers[p].seasons[y].team[0]);
      } else {
        var teamName = getTeamName(bestplayers[p].seasons[y].team[numberteams - 1]);
      }
      var year = bestplayers[p].seasons[y].year;
      var playoffsResult = checkPlayoffs(teamName, year);
      bestplayers[p].seasons[y].playoffs = playoffsResult;
    }
  }
}

function checkPlayoffs(team, year) {
  var index = yearExists(year);
  if(index != -1) {
    resultsArray = playoffsArr[index].results;
    for(s = resultsArray.length - 1 ; s >= 0 ; s--) {
      if(resultsArray[s].winner.startsWith(team) && resultsArray[s].series == "Finals") {
        return ["Champion", resultsArray[s].winner, resultsArray[s].loser, resultsArray[s].gW, resultsArray[s].gL];
      }
      if(resultsArray[s].loser.startsWith(team) && resultsArray[s].series == "Finals") {
        return ["Finals", resultsArray[s].winner, resultsArray[s].loser, resultsArray[s].gW, resultsArray[s].gL];
      }
      if(resultsArray[s].loser.startsWith(team) && resultsArray[s].series != "Finals") {
        return [resultsArray[s].series, resultsArray[s].winner, resultsArray[s].loser, resultsArray[s].gW, resultsArray[s].gL];
      }
    }
  }
  return ["No Playoffs"];
}

function getTeamName(team) {
  return teammap[team];
}

function getCareerPL(playerName) {
  for(s = 0 ; s < careerPL.length ; s++) {
    if(careerPL[s].name == playerName) {
      return careerPL[s].pl;
    }
  }
}

function round(value, precision) {
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(value * multiplier) / multiplier;
}

function setAverages(bestplayers) {
  for(e = 0 ; e < bestplayers.length ; e++) {

    var averagePoints = 0;
    var averageAssists = 0;
    var averageRebounds = 0;
    var averageSteals = 0;
    var averageBlocks = 0;
    var averagePL = 0;
    var averageFG = 0;
    var averageFGA = 0;
    var averageFT = 0;
    var averageFTA = 0;
    var averageT = 0;
    var averageTA = 0;

    var games = 0;

    for(q = 0 ; q < bestplayers[e].seasons.length ; q++) {
      games += bestplayers[e].seasons[q].games;
      averagePoints += bestplayers[e].seasons[q].points;
      averageAssists += bestplayers[e].seasons[q].assists;
      averageRebounds += bestplayers[e].seasons[q].rebounds;
      averageSteals += bestplayers[e].seasons[q].steals;
      averageBlocks += bestplayers[e].seasons[q].blocks;
      averageFG += bestplayers[e].seasons[q].fieldgoals;
      averageFGA += bestplayers[e].seasons[q].fieldgoalsAttempted;
      averageFT += bestplayers[e].seasons[q].freethrows;
      averageFTA += bestplayers[e].seasons[q].freethrowsAttempted;
      averageT += bestplayers[e].seasons[q].threepointers;
      averageTA += bestplayers[e].seasons[q].threepointersAttempted;

      // averagePL += bestplayers[e].seasons[q].plusminus;
    }

    averagePoints = averagePoints/games;
    averageAssists = averageAssists/games;
    averageRebounds = averageRebounds/games;
    averageSteals = averageSteals/games;
    averageBlocks = averageBlocks/games;

    averageFG = averageFG/averageFGA;
    averageFT = averageFT/averageFTA;
    averageT = averageT/averageTA;

    // averagePL = averagePL/bestplayers[e].seasons.length;

    bestplayers[e].averages[0] = averagePoints;
    bestplayers[e].averages[1] = averageAssists;
    bestplayers[e].averages[2] = averageRebounds;
    bestplayers[e].averages[3] = averageSteals;
    bestplayers[e].averages[4] = averageBlocks;
    bestplayers[e].averages[5] = getCareerPL(bestplayers[e].name);
    bestplayers[e].averages[6] = averageFG;
    bestplayers[e].averages[7] = averageFT;
    bestplayers[e].averages[8] = averageT;

  }
}

function checkAverages() {
  for(p = 0 ; p < bestplayers.length ; p++) {
    if(bestplayers[p].name.replace("*", "") == "Michael Jordan") {
      console.log("Career PPG: " + round(bestplayers[p].averages[0], 1));
      console.log("Career APG: " + round(bestplayers[p].averages[1], 1));
      console.log("Career RPG: " + round(bestplayers[p].averages[2], 1));
      console.log("Career SPG: " + round(bestplayers[p].averages[3], 1));
      console.log("Career BPG: " + round(bestplayers[p].averages[4], 1));
      console.log("Career PL: " + round(bestplayers[p].averages[5], 1));
    }
  }
}
//setting up the margins
var margin = {top: 50, right: 50, bottom: 50, left: 50},
width = 1450 - margin.left - margin.right,
height = 700 - margin.top - margin.bottom;
var div = d3.select("body").append("div") 
    .attr("class", "tooltip")       
    .style("opacity", 0);

//adding svg to page
var svg = d3.select("body").append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform", "translate(" + margin.left + "," + 120 + ")");

d3.csv("plusminus.csv", function(data) {
  data.forEach(function(d) {
    var playerName = d.Player;
    var plusminus = +d.BPM;
    var playerObj = {name: playerName, pl: plusminus};
    careerPL.push(playerObj);
  });
});

d3.csv("playoffs.csv", function(data) {
  data.forEach(function(d) {
    var year = +d.Yr;
    var index = yearExists(year);
    if(d.Lg == "NBA" && !d.Series.includes("Tiebreak")) {
      if(index == -1) {
        var playoffRound = {playoffYear: year, results: []};
        var result = {series: d.Series, loser: d.TeamL, winner: d.TeamW, gW: +d.GamesW, gL: +d.GamesL};

        playoffRound.results.push(result);
        playoffsArr.push(playoffRound);
      } else {
        var result = {series: d.Series, loser: d.TeamL, winner: d.TeamW, gW: +d.GamesW, gL: +d.GamesL};

        playoffsArr[index].results.push(result);
      }
    }
  });
});

//reading in player data
d3.csv("seasonstats.csv", function(data) {
  data.forEach(function(d) {
    var name = d.Player;
    var index = alreadyExists(name);
    if(index == -1) {
      var season = {year: +d.Year, points: +d.PTS, assists: +d.AST,
        rebounds: +d.TRB, steals: +d.STL, blocks: +d.BLK,
        plusminus: +d.BPM, games: +d.G, position: d.Pos, team: [d.Tm],
        age: +d.Age, minutes: +d.MP, threepointers: +d.THREEP,
        fieldgoalpercent: +d.FGPERC, threepointerpercent: +d.THREEPPERC,
        freethrowpercent: +d.FTPERC, playoffs: null, fieldgoals: +d.FG,
        fieldgoalsAttempted: +d.FGA, threepointers: +d.THREEP,
        threepointersAttempted: +d.THREEPA, freethrows: +d.FT,
        freethrowsAttempted: +d.FTA};

      var player = {name: d.Player, seasons: [], averages: []};
      player.seasons.push(season);     
      allplayers.push(player);

    } else {
      var yearIndex = yearAdded(index, +d.Year);
      
      if(yearIndex == -1) {
        var season = {year: +d.Year, points: +d.PTS, assists: +d.AST,
          rebounds: +d.TRB, steals: +d.STL, blocks: +d.BLK,
          plusminus: +d.BPM, games: +d.G, position: d.Pos, team: [d.Tm],
          age: +d.Age, minutes: +d.MP, threepointers: +d.THREEP,
          fieldgoalpercent: +d.FGPERC, threepointerpercent: +d.THREEPPERC,
          freethrowpercent: +d.FTPERC, playoffs: null, fieldgoals: +d.FG,
          fieldgoalsAttempted: +d.FGA, threepointers: +d.THREEP,
          threepointersAttempted: +d.THREEPA, freethrows: +d.FT,
          freethrowsAttempted: +d.FTA};

          allplayers[index].seasons.push(season);

      } else {
        allplayers[index].seasons[yearIndex].team.push(d.Tm);
      }
    }
  });

  bestplayers = getBestPlayers();
  setPlayoffs(bestplayers);
  setAverages(bestplayers);

  bestplayers.sort(function(a,b) {
    var x = a.name.toLowerCase();
    var y = b.name.toLowerCase();
    return x < y ? -1 : x > y ? 1 : 0;
  });

  // debugging1(bestplayers);
  // debugging2();

  var select1 = d3.select('body')
    .append('select')
    .attr('class','select')
    .attr('id', 'one')
    .style('position', 'absolute')
    .style('top', '116px')
    .style('left', '28px')
    .on('change',onchange1)

  var options1 = select1
    .selectAll('option')
    .data(bestplayers).enter()
    .append('option')
    .text(function (d, i) { return d.name.replace("*", ""); })

  var select2 = d3.select('body')
    .append('select')
    .attr('class','select')
    .attr('id', 'two')
    .style('position', 'absolute')
    .style('top', '146px')
    .style('left', '28px')
    .on('change',onchange2);

  var options2 = select2
    .selectAll('option')
    .data(bestplayers).enter()
    .append('option')
    .text(function (d) { return d.name.replace("*", ""); })

  var selection1 = document.getElementById('one');
  var index1 = getIndex("LeBron James", bestplayers);
  selection1.selectedIndex = index1;

  var selection2 = document.getElementById('two');
  var index2 = getIndex("Michael Jordan", bestplayers);
  selection2.selectedIndex = index2;

  svg.append("rect")
    .attr("x", -45)
    .attr("y", -50)
    .attr("width", 175)
    .attr("height", 100)       
    .attr("ry", 10)
    .style("fill", "DarkGrey")
    .style('position', 'absolute')
    .attr('stroke-width', '3')
    .attr('stroke', 'black');

  svg.append("text")             
    .attr("transform",
          "translate(40, -25)")
    .style("text-anchor", "middle")
    .style("font-size", "18px")
    .text("Player Filter")
    .style("font-style", "italic")
    .style("font-family", "Helvetica, Arial, Sans-Serif")
    .attr("fill", "white");

  svg.append("text")             
    .attr("transform",
          "translate(350, 240)")
    .style("text-anchor", "middle")
    .style("font-size", "20px")
    .text("Average Stats for Each Season")
    .style("font-family", "Helvetica, Arial, Sans-Serif")
    .attr("fill", "black");

  d3.selectAll("svg")
    .append("image")
    .attr("xlink:href", "playerpictures/" + formatName(d3.select('select#one').property('value')))
    .attr("class", "pico")
    .attr("id", "pic_one")
    .attr("height", 215)
    .attr("width", 358.33)
    .attr("x", 115)
    .attr("y", 70);

  svg.append("text")             
    .attr("transform",
        "translate(243, 185)")
    .attr("id", "text_one")
    .style("text-anchor", "middle")
    .style("font-family", "Helvetica, Arial, Sans-Serif")
    .style("font-size", "14px")
    .text(function() {
      return d3.select('select#one').property('value');
    })
    .attr("fill", "black");

  d3.selectAll("svg")
    .append("image")
    .attr("xlink:href", "playerpictures/" + formatName(d3.select('select#two').property('value')))
    .attr("class", "pico")
    .attr("id", "pic_two")
    .attr("height", 215)
    .attr("width", 358.33)
    .attr("x", 340)
    .attr("y", 70);

  svg.append("text")             
    .attr("transform",
        "translate(465, 185)")
    .attr("id", "text_two")
    .style("text-anchor", "middle")
    .style("font-family", "Helvetica, Arial, Sans-Serif")
    .style("font-size", "14px")
    .text(function() {
      return d3.select('select#two').property('value');
    })
    .attr("fill", "black");

  var index3 = getIndex(d3.select('select#one').property('value'), bestplayers);
  var index4 = getIndex(d3.select('select#two').property('value'), bestplayers);

  function getMinPL(seasonArr1, seasonArr2) {
    var min = 0;
    for(t = 0 ; t < seasonArr1.length ; t++) {
      var plusminus = seasonArr1[t].plusminus;
      if(plusminus < min) {
        min = plusminus;
      }
    }
    for(w = 0 ; w < seasonArr2.length ; w++) {
      var plusminus = seasonArr2[w].plusminus;
      if(plusminus < min) {
        min = plusminus;
      }
    }
    return min;
  }

  function getMax(which, seasonArr1, seasonArr2) {
    var max = 0;
    for(q = 0 ; q < seasonArr1.length ; q++) {
      var games = seasonArr1[q].games;
      if(which == 0) {
        var ppg = seasonArr1[q].points/games;
        if(ppg > max) {
          max = ppg;
        }
      }
      if(which == 1) {
        var apg = seasonArr1[q].assists/games;
        if(apg > max) {
          max = apg;
        }
      }
      if(which == 2) {
        var rpg = seasonArr1[q].rebounds/games;
        if(rpg > max) {
          max = rpg;
        }
      }
      if(which == 3) {
        var bpg = seasonArr1[q].blocks/games;
        if(bpg > max) {
          max = bpg;
        }
      }
      if(which == 4) {
        var spg = seasonArr1[q].steals/games;
        if(spg > max) {
          max = spg;
        }
      }
      if(which == 5) {
        var plusminus = seasonArr1[q].plusminus;
        if(plusminus > max) {
          max = plusminus;
        }
      }
    }
    for(e = 0 ; e < seasonArr2.length ; e++) {
      var games = seasonArr2[e].games;
      if(which == 0) {
        var ppg = seasonArr2[e].points/games;
        if(ppg > max) {
          max = ppg;
        }
      }
      if(which == 1) {
        var apg = seasonArr2[e].assists/games;
        if(apg > max) {
          max = apg;
        }
      }
      if(which == 2) {
        var rpg = seasonArr2[e].rebounds/games;
        if(rpg > max) {
          max = rpg;
        }
      }
      if(which == 3) {
        var bpg = seasonArr2[e].blocks/games;
        if(bpg > max) {
          max = bpg;
        }
      }
      if(which == 4) {
        var spg = seasonArr2[e].steals/games;
        if(spg > max) {
          max = spg;
        }
      }
      if(which == 5) {
        var plusminus = seasonArr2[e].plusminus;
        if(plusminus > max) {
          max = plusminus;
        }
      }
    }
    return max;
  }

  var maxPPG = getMax(0, bestplayers[index3].seasons, bestplayers[index4].seasons);
  var maxAPG = getMax(1, bestplayers[index3].seasons, bestplayers[index4].seasons);
  var maxRPG = getMax(2, bestplayers[index3].seasons, bestplayers[index4].seasons);
  var maxBPG = getMax(3, bestplayers[index3].seasons, bestplayers[index4].seasons);
  var maxSPG = getMax(4, bestplayers[index3].seasons, bestplayers[index4].seasons);
  var maxPL = getMax(5, bestplayers[index3].seasons, bestplayers[index4].seasons);
  var minPL = getMinPL(bestplayers[index3].seasons, bestplayers[index4].seasons);

  function getPPGScale(maxPPG) {
    var ppgScale = d3.scaleLinear().domain([0,maxPPG + 5]).range([530,260]);
    return ppgScale;
  }

  function getAPGScale(maxAPG) {
    var apgScale = d3.scaleLinear().domain([0,maxAPG + 5]).range([530,260]);
    return apgScale;
  }

  function getRPGScale(maxRPG) {
    var rpgScale = d3.scaleLinear().domain([0,maxRPG + 5]).range([530,260]);
    return rpgScale;
  }

  function getBPGScale(maxBPG) {
    var bpgScale = d3.scaleLinear().domain([0,maxBPG]).range([530,260]);
    return bpgScale;
  }

  function getSPGScale(maxSPG) {
    var spgScale = d3.scaleLinear().domain([0,maxSPG]).range([530,260]);
    return spgScale;
  }

  function getPlusMinusScale(maxPL, minPL) {
    var plusminusScale = d3.scaleLinear().domain([minPL,maxPL]).range([530,260]);
    return plusminusScale;
  }

  function getOpacityScale(numberseasons) {
    var opacityScale = d3.scaleLinear().domain([0, numberseasons]).range([0.5, 1]);
    return opacityScale;
  }

  function getCircleScale(stat1, stat2) {
    if(stat1 > stat2) {
      var circleScale = d3.scaleLinear().domain([0, stat1]).range([35, 55]);
    } else {
      var circleScale = d3.scaleLinear().domain([0, stat2]).range([35, 55]);
    }
    return circleScale;
  }

  ppgScale = getPPGScale(maxPPG);
  apgScale = getAPGScale(maxAPG);
  rpgScale = getRPGScale(maxRPG);
  bpgScale = getBPGScale(maxBPG);
  spgScale = getSPGScale(maxSPG);
  plusminusScale = getPlusMinusScale(maxPL, minPL);
  opacityScale = getOpacityScale(bestplayers[index3].seasons.length);

  var labels = ['PPG', 'APG', 'RPG', 'BPG', 'SPG', '+/-'];

  var playoffLabels = ['Champion', 'Finals', 
  'Conference Finals', 'Conference Semifinals', '1st Round', 'No Playoffs'];

  var labelDef = {"PPG": "Points per game", "APG": "Assists per game", "RPG": "Rebounds per game", "BPG": "Blocks per game", "SPG": "Steals per game", "+/-": "Plus minus score"}

  var yearLabels = ['Yr 1', 'Yr 2', 'Yr 3', 'Yr 4', 'Yr 5', 'Yr 6',
  'Yr 7', 'Yr 8', 'Yr 9', 'Yr 10', 'Yr 11', 'Yr 12', 'Yr 13',
  'Yr 14', 'Yr 15', 'Yr 16', 'Yr 17', 'Yr 18', 'Yr 19', 'Yr 20',
  'Yr 21', 'Yr 22', 'Yr 23', 'Yr 24', 'Yr 25'];

  var xScale1 = d3.scaleOrdinal()
    .domain(labels)
    .range([0, 120, 240, 360, 480, 600]);

//overview line chart creation
  svg.append("text")             
      .attr("transform",
          "translate(1020, -90)")
      .style("text-anchor", "middle")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "20px")
      .text("Playoff Results for Each Season")
      .attr("fill", "black");

  svg.append("text")             
      .attr("transform",
          "translate(1010, 220)")
      .style("text-anchor", "middle")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "20px")
      .text("Average Stats for a Single Season")
      .attr("fill", "black");

  svg.append("text")             
      .attr("transform",
          "translate(810, 440)")
      .style("text-anchor", "middle")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "18px")
      .text("Field-Goal Percentage")
      .attr("fill", "black");

  svg.append("text")             
      .attr("transform",
          "translate(1035, 440)")
      .style("text-anchor", "middle")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "18px")
      .text("Free-Throw Percentage")
      .attr("fill", "black");

  svg.append("text")             
      .attr("transform",
          "translate(1250, 440)")
      .style("text-anchor", "middle")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "18px")
      .text("Three-Point Percentage")
      .attr("fill", "black");

  xScale3 = setupOverview(index3, index4);

  function setupOverview(index1, index2) {
      if(bestplayers[index2].seasons.length > bestplayers[index1].seasons.length) {
        var slicedArr = yearLabels.slice(0, bestplayers[index2].seasons.length);
        
        var xScale2 = d3.scaleBand()
          .domain(slicedArr)
          .range([0, (width - 620) - 200]);
        
        var xScale3 = d3.scaleLinear()
          .domain([0, slicedArr.length])
          .range([0, (width - 620) - 200]);

      svg.append("g")
        .attr("class", "x axis")
        .attr("id", "overview")
        .attr("transform", "translate(782, 140)")
        .call(d3.axisBottom(xScale2));

      } else {
        var slicedArr = yearLabels.slice(0, bestplayers[index1].seasons.length);

        var xScale2 = d3.scaleBand()
          .domain(slicedArr)
          .range([0, (width - 570) - 200]);

        var xScale3 = d3.scaleLinear()
          .domain([0, slicedArr.length])
          .range([0, (width - 570) - 200]);

        svg.append("g")
        .attr("class", "x axis")
        .attr("id", "overview")
        .attr("transform", "translate(782, 140)")
        .call(d3.axisBottom(xScale2));
      }

      return xScale3;
  }

  var yScalePlayoffs = d3.scaleOrdinal()
    .domain(playoffLabels)
    .range([0, 40, 80, 120, 160, 200]);

  svg.append("g")
    .attr("class", "y axis")
    .attr("transform", "translate(782, -60)")
    .call(d3.axisLeft(yScalePlayoffs));

  createOverview(index3, "RoyalBlue", "one", xScale3, index4);
  createOverview(index4, "Crimson", "two", xScale3, index3);

  function getPlayerName(id) {
    if(id.includes("one")) {
      var playerNameInd = getIndex(d3.select('select#one').property('value'), bestplayers);
      var playerName = bestplayers[playerNameInd].name.replace("*", "");
    } else {
      var playerNameInd = getIndex(d3.select('select#two').property('value'), bestplayers);
      var playerName = bestplayers[playerNameInd].name.replace("*", "");
    }
    return playerName;
  }

  function getDivInfo(seasonObject, id) {
    var playerName = getPlayerName(id);
    var index = seasonObject.team.length;
    var info = "<font color='white' size='2.75'>" + "Player: " + playerName + "<br/>";
    info += "Team: " + teammap[seasonObject.team[index - 1]] + "<br/>";
    info += "Player Age: " + seasonObject.age + "<br/>";
    info += "Year: " + seasonObject.year + "<br/>";
    info += "Series: " + seasonObject.playoffs[1] + " - " + seasonObject.playoffs[3] + 
    ", " + seasonObject.playoffs[2] + " - " + seasonObject.playoffs[4] + "</font>";
    return info;
  }

  function getAveragePercentage(id, index) {
    var playerName = bestplayers[index].name.replace("*", "");
    if(id.includes("0")) {
      var stat = round(bestplayers[index].averages[6], 3) * 100;
      var statName = "Career Field-Goal %: ";
    }
    if(id.includes("1")) {
      var stat = round(bestplayers[index].averages[7], 3) * 100;
      var statName = "Career Free-Throw %: ";
    }
    if(id.includes("2")) {
      var stat = round(bestplayers[index].averages[8], 3) * 100;
      var statName = "Career Three-Point %: ";
    }
    var info = "<font color='white' size='3'>" + "Player: " + playerName + "</font>" + "<br/>";
    info += "<font color='white' size='3'> " + statName + "</font> "+ "<font color='white' size='7.5'>" + stat.toFixed(1) + "%<br/>" + "</font>";
    return info;
  }

  function getIndividualDivInfo(id, index) {
    div.style("width");
    var playerName = bestplayers[index].name.replace("*", "");
    if(id.includes("0") || id.includes("1")) {
      var stat = round(bestplayers[index].averages[0], 2);
      var statName = "Career Points Per Game: ";
    }
    if(id.includes("2") || id.includes("3")) {
      var stat = round(bestplayers[index].averages[1], 2);
      var statName = "Career Assists Per Game: ";
    }
    if(id.includes("4") || id.includes("5")) {
      var stat = round(bestplayers[index].averages[2], 2);
      var statName = "Career Rebounds Per G: ";
    }
    if(id.includes("6") || id.includes("7")) {
      var stat = round(bestplayers[index].averages[3], 2);
      var statName = "Career Steals Per Game: ";
    }
    if(id.includes("8") || id.includes("9")) {
      var stat = round(bestplayers[index].averages[4], 2);
      var statName = "Career Blocks Per Game: ";
    }
    if(id.includes("10") || id.includes("11")) {
      var stat = round(bestplayers[index].averages[5], 2);
      var statName = "Career Plus/Minus Score: ";
    }
    var info = "<font color='white' size='3'>" + "Player: " + playerName + "</font>" + "<br/>";
    info += "<font color='white' size='3'> " + statName + "</font> "+ "<font color='white' size='7.5'>" + stat + "<br/>" + "</font>";
    return info;
  }

  function getPixels(id) {
    if(id.includes("one")) {
      return (d3.event.pageX - 220) + "px";  //change back later
    } else {
      return (d3.event.pageX - 220) + "px";
    }
  }

  function getColor(id) {
    if(id.includes("one")) {
      return "RoyalBlue";
    } else {
      return "Crimson";
    }
  }

  function setupIndividual() {

    drawDivider(750, 250, 1270, 250, "black", 1, 1);
    drawDivider(935, 250, 935, 380, "black", 1, 1);
    drawDivider(1105, 250, 1105, 380, "black", 1, 1);
    drawDivider(750, 270, 1270, 270, "black", 1, 1);
    drawDivider(750, 315, 1270, 315, "black", 1, 1);
    drawDivider(750, 335, 1270, 335, "black", 1, 1);
    drawDivider(750, 380, 1270, 380, "black", 1, 1);
    drawDivider(750, 250, 750, 380, "black", 1, 1);
    drawDivider(1270, 250, 1270, 380, "black", 1, 1);

    svg.append("text")             
      .attr("transform",
          "translate(765, 265)")
      .style("text-anchor", "start")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "13px")
      .style("font-style", "italic")
      .text("Points Per Game (PPG)")
      .attr("fill", "black");

    svg.append("text")             
      .attr("transform",
          "translate(765, 330)")
      .style("text-anchor", "start")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "13px")
      .style("font-style", "italic")
      .text("Steals Per Game (SPG)")
      .attr("fill", "black");

    svg.append("text")             
      .attr("transform",
          "translate(945, 265)")
      .style("text-anchor", "start")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "13px")
      .style("font-style", "italic")
      .text("Assists Per Game (APG)")
      .attr("fill", "black");

    svg.append("text")             
      .attr("transform",
          "translate(945, 330)")
      .style("text-anchor", "start")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "13px")
      .style("font-style", "italic")
      .text("Blocks Per Game (BPG)")
      .attr("fill", "black");

    svg.append("text")             
      .attr("transform",
          "translate(1110, 265)")
      .style("text-anchor", "start")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "11.5px")
      .style("font-style", "italic")
      .text("Rebounds Per Game (RPG)")
      .attr("fill", "black");

    svg.append("text")             
      .attr("transform",
          "translate(1120, 330)")
      .style("text-anchor", "start")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "13px")
      .text("+/- Score for Season")
      .style("font-style", "italic")
      .attr("fill", "black");
  }
    
  setupIndividual();
  createIndividual(index3, index4, 0);

  function createIndividual(index1, index2, season) {
    var season = parseInt(season, 10);
    var season1 = season;
    var season2 = season;
    // console.log("gonna show " + season + " now");
    if(bestplayers[index1].seasons.length < (season + 1)) {
      season1 = bestplayers[index1].seasons.length - 1;
    }
    if(bestplayers[index2].seasons.length < (season + 1)) {
      season2 = bestplayers[index2].seasons.length - 1;
    }

    var currSeason = parseInt(season, 10);
    currSeason = currSeason + 1.0;

    var games1 = bestplayers[index1].seasons[season1].games;
    var ppg1 = (bestplayers[index1].seasons[season1].points/games1).toFixed(2);
    var apg1 = (bestplayers[index1].seasons[season1].assists/games1).toFixed(2);
    var rpg1 = (bestplayers[index1].seasons[season1].rebounds/games1).toFixed(2);
    var bpg1 = (bestplayers[index1].seasons[season1].blocks/games1).toFixed(2);
    var spg1 = (bestplayers[index1].seasons[season1].steals/games1).toFixed(2);
    var pl1 = (bestplayers[index1].seasons[season1].plusminus).toFixed(2);

    var games2 = bestplayers[index2].seasons[season2].games;
    var ppg2 = (bestplayers[index2].seasons[season2].points/games2).toFixed(2);
    var apg2 = (bestplayers[index2].seasons[season2].assists/games2).toFixed(2);
    var rpg2 = (bestplayers[index2].seasons[season2].rebounds/games2).toFixed(2);
    var bpg2 = (bestplayers[index2].seasons[season2].blocks/games2).toFixed(2);
    var spg2 = (bestplayers[index2].seasons[season2].steals/games2).toFixed(2);
    var pl2 = (bestplayers[index2].seasons[season2].plusminus).toFixed(2);

    appendText(800, 305, ppg1, ppg2, 80, 0, 1, index1, index2);
    appendText(980, 305, apg1, apg2, 70, 2, 3, index1, index2);
    appendText(1140, 305, rpg1, rpg2, 70, 4, 5, index1, index2);
    appendText(800, 370, spg1, spg2, 70, 6, 7, index1, index2);
    appendText(980, 370, bpg1, bpg2, 70, 8, 9, index1, index2);
    appendText(1140, 370, pl1, pl2, 70, 10, 11, index1, index2);

    svg.append("text")             
      .attr("transform",
          "translate(750, 245)")
      .attr("id", "individualText")
      .style("text-anchor", "start")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .style("font-size", "12px")
      .style("font-weight", "bold")
      .text(function() {
        if(season1 == 0) {
          return "Current: Rookie Season (for each player)";
        } else if(season1 != season2) {
          return bestplayers[index1].name.replace("*", "") + ": Season " + (season1+1) +
          ", " + bestplayers[index2].name.replace("*", "") + ": Season " + (season2 + 1);
        } else {
          var currSeason = parseInt(season1, 10);
          currSeason += 1;
          return "Current: Season " + currSeason + " (for each player)"; 
        }
      })
      .attr("fill", "black");
  }

  function drawDivider(x1, y1, x2, y2, color, width, opacity) {
    svg.append("line")
      .attr("x1", x1)
      .attr("y1", y1)
      .attr("x2", x2)
      .attr("y2", y2)
      .attr("stroke-width", width)
      .attr("stroke", color)
      .style("opacity", opacity);
  }

  function appendText(moveX, moveY, stat1, stat2, offset, index1, index2, p1index, p2index) {
    var size1 = "21px";
    var size2 = "30px";
    if(parseFloat(stat1) > parseFloat(stat2)) {
      size1 = "30px";
      size2 = "21px";
    }
    if(parseFloat(stat1) == parseFloat(stat2)) {
      size2 = "21px";
    }
    
    svg.append("text")            
      .attr("transform",
          "translate(" + moveX + ", " + moveY + ")")
      .attr("id", "individuals_" + index1)
      .style("text-anchor", "middle")
      .style("font-size", size1)
      .style("font-style", "italic")
      .text(stat1.toString())
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .attr("fill", "RoyalBlue")
      .on("mouseover", function(d) {  
            div.transition()    
                .duration(400)    
                .style("opacity", .9)        
                .style("height", "90px")
                .style("width", "200px")
                .style("background", "RoyalBlue");
            div.html(getIndividualDivInfo(this.id, p1index))
                .style("left", (d3.event.pageX - 230) + "px")  
                .style("top", (d3.event.pageY - 28) + "px") }) 
      .on("mouseout", function(d) {   
            div.transition()    
                .duration(600)    
                .style("opacity", 0);
      });

    svg.append("text")            
      .attr("transform",
          "translate(" + (moveX + offset) + ", " + moveY + ")")
      .attr("id", "individuals_" + index2)
      .style("text-anchor", "middle")
      .style("font-size", size2)
      .style("font-style", "italic")
      .text(stat2.toString())
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .attr("fill", "Crimson")
      .on("mouseover", function(d) {  
            div.transition()    
                .duration(400)    
                .style("opacity", .9)
                .style("height", "90px")
                .style("width", "200px")
                .style("background", "Crimson");
            div.html(getIndividualDivInfo(this.id, p2index))
                .style("left", (d3.event.pageX - 230) + "px")  
                .style("top", (d3.event.pageY - 28) + "px") })
      .on("mouseout", function(d) {   
            div.transition()    
                .duration(600)    
                .style("opacity", 0);
      });
  }

  function createOverview(index, color, which, xScale, otherIndex) {
    var line = d3.line()
      .x(function(d, i) { return xScale(i); })
      .y(function(d) { return getOverviewPos(d)});

    svg.append("path")
      .datum(bestplayers[index].seasons)
      .attr("id", which)
      .attr("class", "line")
      .attr("transform", "translate(800, -100)")
      .attr("d", line)
      .attr("stroke", color)
      .attr("stroke-width", 2)
      .attr("fill", "none");

    svg.selectAll(".dot" + which)
      .data(bestplayers[index].seasons)
      .enter().append("ellipse")
      .attr("id", function(d, i) { 
        return 'circle_' + which + '_' + i; })
      .attr("class", "dot")
      .attr("cx", function(d, i) { return xScale3(i); })
      .attr("cy", function(d) { return getOverviewPos(d); })
      .attr("transform", "translate(800, -100)")
      .attr("fill", color)
      .attr("rx", function() {
        if(color == "RoyalBlue") {
          return 4;
        } else {
          return 7;
        }
      })
      .attr("ry", function() {
        if(color == "RoyalBlue") {
          return 7;
        } else {
          return 4;
        }
      })
      .on("mouseover", function(d) {
        if(d.playoffs.length > 1) {  
            div.transition()    
                .duration(400)    
                .style("height", "90px")
                .style("width", "200px")
                .style("opacity", .9); 
            div.html(getDivInfo(d, this.id))
                .style("left", getPixels(this.id))   
                .style("top", (d3.event.pageY - 28) + "px")
                .style("background", getColor(this.id));
        } else {
            var index = d.team.length;
            var playerName = getPlayerName(this.id);
            var info = "<font color='white' size=2.75>" + "Player: " + playerName + "<br/>";
            info += "Team: " + teammap[d.team[index - 1]] + "<br/>";
            info += "Player Age: " + d.age + "<br/>";
            info += "Year: " + d.year + "<br/>";
            info += "Did not make playoffs" + "</font>";
            div.transition()    
                .duration(400)
                .style("height", "75px")
                .style("width", "200px")    
                .style("opacity", .9); 
            div .html(info)
                .style("left", getPixels(this.id))   
                .style("top", (d3.event.pageY - 28) + "px")
                .style("background", getColor(this.id));  
            }
        })     
        .on("mouseout", function(d) {  
            div.transition()    
                .duration(600)    
                .style("opacity", 0);
        })
        .on("click", function(d) {
            for(w = 0 ; w < 12 ; w++) {
                d3.select('#individuals_' + w).remove();
            }
            for(r = 0 ; r < 3 ; r++) {
                d3.select('#individualTextRed_' + r).remove();
                d3.select('#individualTextBlue_' + r).remove();
                d3.select('#individualRed_' + r).remove();
                d3.select('#individualBlue_' + r).remove();
            }
            d3.select('#individualText').remove();
            var id = this.id.substr(this.id.length - 2).replace("_", "");
            if(which == "one") {
              createIndividual(index, otherIndex, id);
              createPercentages(index, otherIndex, id);
            } else {
              createIndividual(otherIndex, index, id);
              createPercentages(otherIndex, index, id);
            }
        });
    }

    function getStatDefinition(stat) {
        var definition;
        var textSize = 2.75;

        if(stat.includes("PPG"))
        {
          definition = "PPG stands for 'Points Per Game', which is the amount of points a player scores per game."
              +"  Points are scored through field-goals (any 2-point shot), free throws (foul shots), or three-point shots.";
          div.style("height", "105px");
        }

        if(stat.includes("APG"))
        {
          definition = "APG stands for 'Assists Per Game', which is the amount of assists a player gets per game. "
            +"An assist is noted for a player if they pass it to a teammate in a way that leads to the teammate scoring.";
          div.style("height", "105px");
        }

        if(stat.includes("RPG"))
        {
          definition = "RPG stands for 'Rebounds Per Game', which is the number of rebounds obtained per game. "
            +"A rebound, sometimes referred to as a \"board\", is recorded for a player if he retrieves the ball after "
            +"a missed shot.";
          div.style("height", "105px");
        }

        if(stat.includes("BPG"))
        {
          definition = "BPG stands for 'Blocks Per Game', which is the number of blocks committed per game. "
            +"A block is given to a player that deflects a shot; but if a foul is called from player contact, no block is recorded.";
          div.style("height", "105px");
        }

        if(stat.includes("SPG"))
        {
          definition = " SPG stands for 'Steals Per Game', which is the number of steals obtained per game. A steal is awarded to a defensive player who forces a turnover, taking the "
            +"ball from the team on offense."
          div.style("height", "98px");
        }

        if(stat.includes("+/-"))
        {
          definition = "+/- stands for the 'Plus-Minus Score' of a player, which is a metric that compares how a team performs when a player "
            +"is on or off the court. The metric calculates the point difference of the two teams when the player is playing versus not playing.";

          div.style("height", "120px");
        }

        definition = "<font color = 'white' size = '" + textSize+"'> " + definition + "</font>";
        // console.log(definition);
        return definition;
      }

    function getOverviewPos(seasonObj) {
      if(seasonObj.playoffs == "No Playoffs") {
        return 240;
      }
      if(seasonObj.playoffs[0].includes("First Round")) {
        return 200;
      }
      if(seasonObj.playoffs[0].includes("Semifinals")) {
        return 160;
      }
      if(seasonObj.playoffs[0].includes("Conf") && seasonObj.playoffs[0].includes("Finals")) {
        return 120;
      }
      if(seasonObj.playoffs[0].includes("Div") && seasonObj.playoffs[0].includes("Finals")) {
        return 120;
      }
      if(seasonObj.playoffs[0] == "Finals") {
        return 80;
      }
      if(seasonObj.playoffs[0] == "Champion") {
        return 40;
      }
    }

  svg.append("g")
      .attr("id", "yone")
      .attr("class", "y axis")
      .attr("transform", "translate(60, 0)")
      .call(d3.axisLeft(getPPGScale(maxPPG)));

  svg.append("g")
      .attr("id", "ytwo")
      .attr("class", "y axis")
      .attr("transform", "translate(180, 0)")
      .call(d3.axisLeft(getAPGScale(maxAPG)));

  svg.append("g")
      .attr("id", "ythree")
      .attr("class", "y axis")
      .attr("transform", "translate(300, 0)")
      .call(d3.axisLeft(getRPGScale(maxRPG)));

  svg.append("g")
      .attr("id", "yfour")
      .attr("class", "y axis")
      .attr("transform", "translate(420, 0)")
      .call(d3.axisLeft(getBPGScale(maxBPG)));

  svg.append("g")
      .attr("id", "yfive")
      .attr("class", "y axis")
      .attr("transform", "translate(540, 0)")
      .call(d3.axisLeft(getSPGScale(maxSPG))); 

  svg.append("g")
      .attr("id", "ysix")
      .attr("class", "y axis")
      .attr("transform", "translate(660, 0)")
      .call(d3.axisLeft(getPlusMinusScale(maxPL, minPL)));

  svg.append("g")
      .attr("class", "x axis")
      .attr("id", "statXAxis")
      .attr("transform", "translate(60, 540)")
      .call(d3.axisBottom(xScale1));

d3.select("#statXAxis")
    .selectAll(".tick")
    .on("mouseover", function(d){
      // console.log("The text is" + d);
      var labelstext = labelDef[d];
      // console.log(labelstext);  
      div.transition()
        .duration(400)
        .style("opacity", .9)
      div.html(getStatDefinition(d))
        // .style("left", (2) + "px")  
        // .style("top", (380) + "px") //temporarily removed
        .style("left", (d3.event.pageX - 28) + "px")
        .style("top", (d3.event.pageY - 150) + "px")
        .style("width", "200px")
        .style("background", "grey")})
    .on("mouseout", function(d){
      div.transition()
        .duration(600)
        .style("opacity", 0)
        .style("width", "200px")
  });
  
  createQuestionTip(28, 552, 40,"Hover your mouse over any of the stat labels in this x-axis to read the definition of that stat!"); //put the bubble by the ppg
  createQuestionTip(145, 230, 45,"Hover your mouse over either player's name in the Legend to filter out the other player!"); //tooltip by the legend
  createQuestionTip(770, 163, 90,"Hover your mouse over any point in the 'Playoff Results for Each Season' graph to see the Playoff results for that series! \nAlso, click any point in the graph to update the two charts below, which changes the 'Current:' season label!"); //tooltip by the playoff graph (by the title: 1172, -93, 70   by the x/y axis: 775, 157, 70   by top y-axis: 780, -75, 70)
  createQuestionTip(755, 393, 40,"Hover over any number in the 'Average Stats for a Single Season' chart to see the career average stat for either player!"); //put the bubble at the bottom of the table

  createQuestionTip(700, 570, 30,"Hover over any circle to see the career average percentage for either player!"); //add another buble for circles chart

  function createQuestionTip(x, y, height, textTip)
  {
    svg.append("g")
        .append("circle")
          .attr("transform",
            "translate("+x+","+y+")")
          .attr("r", 8)
          .attr("fill", "black")
          .style("opacity", 0.7);

    svg.append("g")
        .append("circle")
          .attr("transform",
            "translate("+x+","+y+")")
          .attr("r", 6)
          .attr("fill", "DarkGrey")
          .style("opacity", 0.7);

    svg.append("text")
        .attr("transform",
            "translate("+(x-3.5)+","+(y+5)+")")
        .text("?")
        .style("font-size", 14)
        .style("fill", "white")
        .style("opacity", 0.7);

    svg.append("g")
        .append("circle")
          .attr("transform",
            "translate("+x+","+y+")")
          .attr("r", 7)
          .attr("fill", "DarkGrey")
          .style("opacity", 0)
          .on("mouseover", function(d)
          {
            div.transition()
                .duration(400)
                .style("opacity", .9)
                .style("background", "grey")
                .style("height", height+"px")
                .style("width", "220px")
            div.html(textTip)
                .style("color", "white")
                .style("left", (d3.event.pageX + 10) + "px")  
                .style("top", (d3.event.pageY-(height/2)) + "px") 
                .style("height", "90px")
                .style("width", "200px") 
      
          })
          .on("mouseout", function(d)
          {
            div.transition()
                .duration(400)
                .style("opacity", 0)
                .style("height", "90px")
                .style("width", "200px")
          })
  }
  var scales = [ppgScale, apgScale, rpgScale, bpgScale, spgScale, plusminusScale, opacityScale];

  drawLines(index3, "RoyalBlue", "one", scales);

  scales[6] = getOpacityScale(bestplayers[index4].seasons.length);

  drawLines(index4, "Crimson", "two", scales);

  drawLegend(d3.select('select#one').property('value'), d3.select('select#two').property('value'));

  function drawLines(index, color, numb, scales) {
    for(var r = 0 ; r < bestplayers[index].seasons.length ; r++) {

      var games = bestplayers[index].seasons[r].games;
      var ppg = bestplayers[index].seasons[r].points/games;
      var apg = bestplayers[index].seasons[r].assists/games;
      var rpg = bestplayers[index].seasons[r].rebounds/games;
      var bpg = bestplayers[index].seasons[r].blocks/games;
      var spg = bestplayers[index].seasons[r].steals/games;
      var plusminus = bestplayers[index].seasons[r].plusminus;
      drawLine(60, 180, color, r, ppg, apg, numb, scales);
      drawLine(180, 300, color, r, apg, rpg, numb, scales);
      drawLine(300, 420, color, r, rpg, bpg, numb, scales);
      drawLine(420, 540, color, r, bpg, spg, numb, scales);
      drawLine(540, 660, color, r, spg, plusminus, numb, scales);

    }
  }

  function drawLine(start, end, color, r, stat1, stat2, numb, scales) {
    var attrID = "line" + start + "_" + r.toString() + numb;

    ppgScale = scales[0];
    apgScale = scales[1];
    rpgScale = scales[2];
    bpgScale = scales[3];
    spgScale = scales[4];
    plusminusScale = scales[5];
    opacityScale = scales[6];

    if(start == 60) {
      var y1 = ppgScale(stat1);
      var y2 = apgScale(stat2);
    }
    if(start == 180) {
      var y1 = apgScale(stat1);
      var y2 = rpgScale(stat2);
    }
    if(start == 300) {
      var y1 = rpgScale(stat1);
      var y2 = bpgScale(stat2);
    } 
    if(start == 420) {
      var y1 = bpgScale(stat1);
      var y2 = spgScale(stat2);
    }
    if(start == 540) {
      var y1 = spgScale(stat1);
      var y2 = plusminusScale(stat2);
    }   

    svg.append("line")
      .attr("id", attrID)
      .attr("x1", start)
      .attr("y1", y1)
      .attr("x2", end)
      .attr("y2", y2)
      .attr("stroke-width", 1)
      .attr("stroke", color)
      .attr("opacity", function(d) { return opacityScale(r); });
  }

  createPercentages(index3, index4, 0);

  function drawCircleStat(stat1, stat2, which, offset, index1, index2) {
      circleScale = getCircleScale(stat1, stat2);
      radius1 = circleScale(stat1);
      radius2 = circleScale(stat2);

      svg.append("circle")
        .attr("id", "individualBlue_" + which)
        .attr("cx", offset+34)
        .attr("cy", 510)
        .attr("r", radius1)
        .attr("fill", "RoyalBlue")
        .on("mouseover", function(d) {  
            div.transition()    
                .duration(400)    
                .style("opacity", .9)        
                .style("height", "90px")
                .style("width", "200px")
                .style("background", "RoyalBlue");
            div.html(getAveragePercentage(this.id, index1))
                .style("left", (d3.event.pageX - 230) + "px")  
                .style("top", (d3.event.pageY - 28) + "px") }) 
        .on("mouseout", function(d) {
            div.transition()    
                .duration(600)    
                .style("opacity", 0);
        });

      if(stat1 == 0) {
        newOffset = offset + 45;
        firstTextOffset = offset + 3;
      } else {
        newOffset = offset;
        firstTextOffset = offset;
      }

      svg.append("circle")
        .attr("id", "individualRed_" + which)
        .attr("cx", newOffset+(radius1*2.5))
        .attr("cy", 510)
        .attr("r", radius2)
        .attr("fill", "Crimson")
        .on("mouseover", function(d) {  
            div.transition()    
                .duration(400)    
                .style("opacity", .9)        
                .style("height", "90px")
                .style("width", "200px")
                .style("background", "Crimson");
            div.html(getAveragePercentage(this.id, index2))
                .style("left", (d3.event.pageX - 230) + "px")  
                .style("top", (d3.event.pageY - 28) + "px") }) 
        .on("mouseout", function(d) {   
            div.transition()    
                .duration(600)    
                .style("opacity", 0);
      });

      svg.append("text")
        .attr("transform",
          "translate(" + (firstTextOffset) + ", 520)")
        .attr("id", "individualTextBlue_" + which)
        .style("text-anchor", "left")
        .style("font-size", "24px")
        .text(stat1.toFixed(1) + "%")
        .style("font-family", "Helvetica, Arial, Sans-Serif")
        .style("font-style", "italic")
        .attr("fill", "white")
        .on("mouseover", function(d) {  
            div.transition()    
                .duration(400)    
                .style("opacity", .9)        
                .style("height", "90px")
                .style("width", "200px")
                .style("background", "RoyalBlue");
            div.html(getAveragePercentage(this.id, index1))
                .style("left", (d3.event.pageX - 230) + "px")  
                .style("top", (d3.event.pageY - 28) + "px") }) 
        .on("mouseout", function(d) {   
            div.transition()    
                .duration(600)    
                .style("opacity", 0);
        });


      if(stat2 == 0) {
        offset = offset + 13;
      }

      svg.append("text")            
        .attr("transform",
          "translate(" + (offset + 100) + ", 520)")
        .attr("id", "individualTextRed_" + which)
        .style("text-anchor", "left")
        .style("font-size", "24px")
        .text(stat2.toFixed(1) + "%")
        .style("font-family", "Helvetica, Arial, Sans-Serif")
        .style("font-style", "italic")
        .attr("fill", "white")
        .on("mouseover", function(d) {  
            div.transition()    
                .duration(400)    
                .style("opacity", .9)        
                .style("height", "90px")
                .style("width", "200px")
                .style("background", "Crimson");
            div.html(getAveragePercentage(this.id, index2))
                .style("left", (d3.event.pageX - 230) + "px")  
                .style("top", (d3.event.pageY - 28) + "px") }) 
        .on("mouseout", function(d) {   
            div.transition()    
                .duration(600)    
                .style("opacity", 0);
      });
  }

  function createPercentages(index1, index2, season) {
    var season = parseInt(season, 10);
    var season1 = season;
    var season2 = season;

    if(bestplayers[index1].seasons.length < (season + 1)) {
      season1 = bestplayers[index1].seasons.length - 1;
    }
    if(bestplayers[index2].seasons.length < (season + 1)) {
      season2 = bestplayers[index2].seasons.length - 1;
    }

    var fg1 = round(bestplayers[index1].seasons[season1].fieldgoalpercent * 100, 2);
    var fg2 = round(bestplayers[index2].seasons[season2].fieldgoalpercent * 100, 2);
    var three1 = round(bestplayers[index1].seasons[season1].threepointerpercent * 100, 2);
    var three2 = round(bestplayers[index2].seasons[season2].threepointerpercent * 100, 2);
    var ft1 = round(bestplayers[index1].seasons[season1].freethrowpercent * 100, 2);
    var ft2 = round(bestplayers[index2].seasons[season2].freethrowpercent * 100, 2);

    drawCircleStat(fg1, fg2, 0, 720, index1, index2);
    drawCircleStat(ft1, ft2, 1, 940, index1, index2);
    drawCircleStat(three1, three2, 2, 1165, index1, index2);
    drawDivider(918, 430, 918, 615, "DarkGrey", 2, 0.3);
    drawDivider(1142, 430, 1142, 615, "DarkGrey", 2, 0.3);
  }

  function drawLegend(player1, player2) {
    svg.append("line")
      .attr("x1", -40)
      .attr("y1", 160)
      .attr("x2", -40)
      .attr("y2", 240)
      .attr("stroke-width", 3)
      .attr("stroke", "black");

    svg.append("line")
      .attr("x1", 125)
      .attr("y1", 160)
      .attr("x2", 125)
      .attr("y2", 240)
      .attr("stroke-width", 3)
      .attr("stroke", "black");

    svg.append("line")
      .attr("x1", -40)
      .attr("y1", 161)
      .attr("x2", 125)
      .attr("y2", 161)
      .attr("stroke-width", 3)
      .attr("stroke", "black");

    svg.append("line")
      .attr("x1", -40)
      .attr("y1", 240)
      .attr("x2", 125)
      .attr("y2", 240)
      .attr("stroke-width", 3)
      .attr("stroke", "black");

    svg.append("line")
      .attr("x1", -30)
      .attr("y1", 187)
      .attr("x2", -4)
      .attr("y2", 187)
      .attr("stroke-width", 5)
      .attr("stroke", "RoyalBlue");

    svg.append("line")
      .attr("x1", -30)
      .attr("y1", 215)
      .attr("x2", -4)
      .attr("y2", 215)
      .attr("stroke-width", 5)
      .attr("stroke", "Crimson");

    svg.append("text")   
      .attr("id", "legendone")          
      .attr("transform",
          "translate(55, 190)")
      .style("text-anchor", "middle")
      .style("font-size", "13px")
      .text(player1)
      .attr("fill", "black")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .on("mouseover", function() {
        for(a = 0 ; a < 600 ; a++) {
          for(r = 0 ; r < 20 ; r++) {
            d3.select('#line' + a + "_" + r + "two").style("opacity", 0);
          }
        }
      })
      .on("mouseout", function() {
        for(a = 0 ; a < 600 ; a++) {
          for(r = 0 ; r < 20 ; r++) {
            d3.select('#line' + a + "_" + r + "two").style("opacity", function(d) { 
              return opacityScale(r); });
          }
        }      
      });

    svg.append("text")  
      .attr("id", "legendtwo")          
      .attr("transform",
          "translate(55, 218)")
      .style("text-anchor", "middle")
      .style("font-size", "13px")
      .text(player2)
      .attr("fill", "black")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .on("mouseover", function() {
        for(a = 0 ; a < 600 ; a++) {
          for(r = 0 ; r < 20 ; r++) {
            d3.select('#line' + a + "_" + r + "one").style("opacity", 0);
          }
        }
      })
      .on("mouseout", function() {
        for(a = 0 ; a < 600 ; a++) {
          for(r = 0 ; r < 20 ; r++) {
            d3.select('#line' + a + "_" + r + "one").style("opacity", function(d) { return opacityScale(r); });
          }
        }
      });

    svg.append("text")            
      .attr("transform",
          "translate(40, 150)")
      .style("text-anchor", "middle")
      .style("font-size", "15px")
      .text("Legend")
      .style("font-family", "Helvetica, Arial, Sans-Serif")
      .attr("fill", "black");
  }

  function onchange1() {
    selectValue = d3.select('select#one').property('value');
    selectValueOther = d3.select('select#two').property('value');

    d3.select('image#pic_one').attr("xlink:href", "playerpictures/" + formatName(selectValue));
    d3.select('text#text_one').text(selectValue);
    d3.select('text#legendone').text(selectValue);

    for(a = 0 ; a < 600 ; a++) {
      for(r = 0 ; r < 20 ; r++) {
        d3.select('#line' + a + "_" + r + "one").remove();
      }
    }

    for(a = 0 ; a < 600 ; a++) {
      for(r = 0 ; r < 20 ; r++) {
        d3.select('#line' + a + "_" + r + "two").remove();
      }
    }

    d3.select('#yone').remove();
    d3.select('#ytwo').remove();
    d3.select('#ythree').remove();
    d3.select('#yfour').remove();
    d3.select('#yfive').remove();
    d3.select('#ysix').remove();

    for(k = 0 ; k < 25 ; k++) {
      d3.select('#circle_' + 'one' + '_' + k).remove();
      d3.select('#circle_' + 'two' + '_' + k).remove();
    }

    d3.select('path#' + 'one').remove();
    d3.select('path#' + 'two').remove();
    d3.select('#overview').remove();

    for(w = 0 ; w < 12 ; w++) {
      d3.select('#individuals_' + w).remove();
    }

    d3.select('#individualText').remove();
    for(r = 0 ; r < 3 ; r++) {
      d3.select('#individualTextRed_' + r).remove();
      d3.select('#individualTextBlue_' + r).remove();
      d3.select('#individualRed_' + r).remove();
      d3.select('#individualBlue_' + r).remove();
    }
    
    var index1 = getIndex(selectValue, bestplayers);
    var index2 = getIndex(selectValueOther, bestplayers);
    var maxPPG = getMax(0, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxAPG = getMax(1, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxRPG = getMax(2, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxBPG = getMax(3, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxSPG = getMax(4, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxPL = getMax(5, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var minPL = getMinPL(bestplayers[index1].seasons, bestplayers[index2].seasons);

    ppgScale = getPPGScale(maxPPG);
    apgScale = getAPGScale(maxAPG);
    rpgScale = getRPGScale(maxRPG);
    bpgScale = getBPGScale(maxBPG);
    spgScale = getSPGScale(maxSPG);
    plusminusScale = getPlusMinusScale(maxPL, minPL);
    opacityScale = getOpacityScale(bestplayers[index1].seasons.length);

    var scales = [ppgScale, apgScale, rpgScale, bpgScale, spgScale, plusminusScale, opacityScale];

    drawAxes(scales);

    drawLines(index1, "RoyalBlue", "one", scales);
    scales[6] = getOpacityScale(bestplayers[index2].seasons.length);
    drawLines(index2, "Crimson", "two", scales);

    xScale3 = setupOverview(index1, index2);
    createOverview(index1, "RoyalBlue", "one", xScale3, index2);
    createOverview(index2, "Crimson", "two", xScale3, index1);

    createIndividual(index1, index2, 0);
    createPercentages(index1, index2, 0);
  };

  function onchange2() {
    selectValue = d3.select('select#two').property('value')
    selectValueOther = d3.select('select#one').property('value');

    d3.select('image#pic_two').attr("xlink:href", "playerpictures/" + formatName(selectValue));
    d3.select('text#text_two').text(selectValue);
    d3.select('text#legendtwo').text(selectValue);

    for(a = 0 ; a < 600 ; a++) {
      for(r = 0 ; r < 20 ; r++) {
        d3.select('#line' + a + "_" + r + "one").remove();
        d3.select('#circle_' + 'one' + '_' + r)
      }
    }

    for(a = 0 ; a < 600 ; a++) {
      for(r = 0 ; r < 20 ; r++) {
        d3.select('#line' + a + "_" + r + "two").remove();
      }
    }

    d3.select('#yone').remove();
    d3.select('#ytwo').remove();
    d3.select('#ythree').remove();
    d3.select('#yfour').remove();
    d3.select('#yfive').remove();
    d3.select('#ysix').remove();

    for(k = 0 ; k < 25 ; k++) {
      d3.select('#circle_' + 'one' + '_' + k).remove();
      d3.select('#circle_' + 'two' + '_' + k).remove();
    }

    d3.select('path#' + 'one').remove();
    d3.select('path#' + 'two').remove();
    d3.select('#overview').remove();

    for(w = 0 ; w < 12 ; w++) {
      d3.select('#individuals_' + w).remove();
    }

    d3.select('#individualText').remove();
    for(r = 0 ; r < 3 ; r++) {
      d3.select('#individualTextRed_' + r).remove();
      d3.select('#individualTextBlue_' + r).remove();
      d3.select('#individualRed_' + r).remove();
      d3.select('#individualBlue_' + r).remove();
    }

    var index2 = getIndex(selectValue, bestplayers);
    var index1 = getIndex(selectValueOther, bestplayers);
    var maxPPG = getMax(0, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxAPG = getMax(1, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxRPG = getMax(2, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxBPG = getMax(3, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxSPG = getMax(4, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var maxPL = getMax(5, bestplayers[index1].seasons, bestplayers[index2].seasons);
    var minPL = getMinPL(bestplayers[index1].seasons, bestplayers[index2].seasons);

    ppgScale = getPPGScale(maxPPG);
    apgScale = getAPGScale(maxAPG);
    rpgScale = getRPGScale(maxRPG);
    bpgScale = getBPGScale(maxBPG);
    spgScale = getSPGScale(maxSPG);
    plusminusScale = getPlusMinusScale(maxPL, minPL);
    opacityScale = getOpacityScale(bestplayers[index1].seasons.length);

    var scales = [ppgScale, apgScale, rpgScale, bpgScale, spgScale, plusminusScale, opacityScale];

    drawAxes(scales);

    drawLines(index2, "Crimson", "two", scales);
    scales[6] = getOpacityScale(bestplayers[index2].seasons.length);
    drawLines(index1, "RoyalBlue", "one", scales);

    xScale3 = setupOverview(index1, index2);

    createOverview(index1, "RoyalBlue", "one", xScale3, index2);
    createOverview(index2, "Crimson", "two", xScale3, index1);

    createIndividual(index1, index2, 0);
    createPercentages(index1, index2, 0);
  };

  function drawAxes(scales) {
    svg.append("g")
      .attr("id", "yone")
      .attr("class", "y axis")
      .attr("transform", "translate(60, 0)")
      .call(d3.axisLeft(scales[0]));

    svg.append("g")
      .attr("id", "ytwo")
      .attr("class", "y axis")
      .attr("transform", "translate(180, 0)")
      .call(d3.axisLeft(scales[1]));

    svg.append("g")
      .attr("id", "ythree")
      .attr("class", "y axis")
      .attr("transform", "translate(300, 0)")
      .call(d3.axisLeft(scales[2]));

    svg.append("g")
      .attr("id", "yfour")
      .attr("class", "y axis")
      .attr("transform", "translate(420, 0)")
      .call(d3.axisLeft(scales[3]));

    svg.append("g")
      .attr("id", "yfive")
      .attr("class", "y axis")
      .attr("transform", "translate(540, 0)")
      .call(d3.axisLeft(scales[4]));   

    svg.append("g")
      .attr("id", "ysix")
      .attr("class", "y axis")
      .attr("transform", "translate(660, 0)")
      .call(d3.axisLeft(scales[5]));

  }

});

</script>

  </body>
</html>